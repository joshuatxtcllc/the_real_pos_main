import{j as e}from"./ui-O3Y4hNsB.js";import{r as R}from"./vendor--0RGCJ5T.js";import{b as A,u as P,a as L}from"./query-DSGfYlti.js";import{u as T,A as j,a as p,B as g,C as r,b as c,c as l,d as o,e as m,f}from"./index-D9tp6WKo.js";import{R as N,ad as w,aa as D,p as M,J as S}from"./icons-DNNJj53b.js";import"./utils-CJ8RBMVN.js";import"./charts-zhNjaY9P.js";import"./forms-BphQ7k6W.js";function z(){const{toast:d}=T(),y=A(),[x,h]=R.useState(!1),{data:a,isLoading:b,error:v}=P({queryKey:["/api/pricing-monitor/status"],refetchInterval:3e5}),C=L({mutationFn:async()=>{const s=await fetch("/api/pricing-monitor/check",{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to trigger pricing check");return s.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/pricing-monitor/status"]}),d({title:"Pricing Check Complete",description:"Latest pricing alignment has been analyzed"})},onError:s=>{d({title:"Check Failed",description:s.message,variant:"destructive"})}}),k=async()=>{try{const s=await fetch("/api/pricing-monitor/report");if(!s.ok)throw new Error("Failed to generate report");const n=await s.blob(),u=window.URL.createObjectURL(n),i=document.createElement("a");i.href=u,i.download=`pricing-report-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(u),document.body.removeChild(i),d({title:"Report Downloaded",description:"Pricing alignment report has been downloaded"})}catch{d({title:"Download Failed",description:"Could not download the pricing report",variant:"destructive"})}},F=async()=>{h(!0);try{await C.mutateAsync()}finally{h(!1)}};if(b)return e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(N,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading pricing status..."})]});if(v||!(a!=null&&a.success))return e.jsxs(j,{variant:"destructive",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx(p,{children:"Failed to load pricing status. Please try again later."})]});const{data:t}=a;return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Pricing Monitor"}),e.jsx("p",{className:"text-muted-foreground",children:"Automated monitoring of pricing alignment with industry standards"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",onClick:k,className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Download Report"]}),e.jsxs(g,{onClick:F,disabled:x,className:"flex items-center gap-2",children:[e.jsx(N,{className:`h-4 w-4 ${x?"animate-spin":""}`}),x?"Checking...":"Check Now"]})]})]}),e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[t.adjustmentsNeeded?e.jsx(w,{className:"h-5 w-5 text-orange-500"}):e.jsx(M,{className:"h-5 w-5 text-green-500"}),"Pricing Alignment Status"]}),e.jsxs(o,{children:["Last checked: ",new Date(a.timestamp).toLocaleString()]})]}),e.jsx(m,{children:e.jsx(j,{variant:t.adjustmentsNeeded?"destructive":"default",children:e.jsx(p,{className:"text-base",children:t.summary})})})]}),e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsx(l,{children:"Current Pricing Analysis"}),e.jsx(o,{children:"Comparison of current prices against industry benchmarks"})]}),e.jsx(m,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:t.currentPrices.map((s,n)=>e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.scenario}),e.jsxs(f,{variant:"outline",children:["$",s.totalPrice.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Frame:"}),e.jsxs("span",{children:["$",s.breakdown.frame.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mat:"}),e.jsxs("span",{children:["$",s.breakdown.mat.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Glass:"}),e.jsxs("span",{children:["$",s.breakdown.glass.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Labor:"}),e.jsxs("span",{children:["$",s.breakdown.labor.toFixed(2)]})]})]})]},n))})})]}),t.recommendations.length>0&&e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Pricing Adjustment Recommendations"]}),e.jsx(o,{children:"Suggested changes to align with industry standards"})]}),e.jsx(m,{children:e.jsx("div",{className:"space-y-4",children:t.recommendations.map((s,n)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold capitalize",children:[s.component," Adjustment"]}),e.jsxs(f,{variant:s.adjustment>0?"destructive":"secondary",children:[s.adjustment>0?"+":"",Math.round(s.adjustment*100),"%"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.reason}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:["Current Factor: ",s.currentFactor.toFixed(3)]}),e.jsxs("div",{children:["Recommended Factor: ",s.recommendedFactor.toFixed(3)]})]})]},n))})})]}),e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsx(l,{children:"Automated Monitoring"}),e.jsx(o,{children:"This system runs automatically every 6 hours to ensure pricing stays competitive"})]}),e.jsx(m,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold",children:"Next Check"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scheduled for 6 hours from last run"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold",children:"Tolerance"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Â±15% from industry targets"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold",children:"Action Required"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.adjustmentsNeeded?"Yes - Review recommendations":"No - All aligned"})]})]})})]})]})}export{z as default};
